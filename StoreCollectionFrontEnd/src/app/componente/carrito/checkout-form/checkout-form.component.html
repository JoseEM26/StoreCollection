<div class="checkout-container">
  <div class="checkout-card">
    <!-- Encabezado Premium -->
    <div class="checkout-header">
      <div class="header-content">
        <h3 class="checkout-title">
          <i class="bi bi-truck"></i>
          Finalizar Compra
        </h3>
        <p class="checkout-subtitle">
          Completa tus datos para procesar el pedido
        </p>
      </div>
    </div>

    <!-- Cuerpo del formulario -->
    <div class="checkout-body">
      <form [formGroup]="checkoutForm" (ngSubmit)="submit()">
        <!-- ====================== DATOS PERSONALES ====================== -->
        <section class="form-section">
          <h5 class="section-title">
            <i class="bi bi-person-circle"></i> Datos Personales
          </h5>

          <div class="row g-4">
            <div class="col-md-6">
              <label class="form-label">Nombre completo <span class="required">*</span></label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     formControlName="compradorNombre"
                     [class.is-invalid]="f['compradorNombre'].touched && f['compradorNombre'].invalid"
                     placeholder="Juan Pérez Gómez">
              <div class="invalid-feedback">
                <small *ngIf="f['compradorNombre'].errors?.['required']">El nombre es obligatorio</small>
                <small *ngIf="f['compradorNombre'].errors?.['minlength']">Mínimo 3 caracteres</small>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label">Email <span class="required">*</span></label>
              <input type="email" 
                     class="form-control form-control-lg" 
                     formControlName="compradorEmail"
                     [class.is-invalid]="f['compradorEmail'].touched && f['compradorEmail'].invalid"
                     placeholder="juan@ejemplo.com">
              <div class="invalid-feedback">
                <small *ngIf="f['compradorEmail'].errors?.['required']">El email es obligatorio</small>
                <small *ngIf="f['compradorEmail'].errors?.['email']">Email inválido</small>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label">Teléfono / WhatsApp</label>
              <div class="input-group input-group-lg">
                <span class="input-group-text"><i class="bi bi-whatsapp"></i></span>
                <input type="tel" 
                       class="form-control" 
                       formControlName="compradorTelefono"
                       placeholder="+51 999 123 456">
              </div>
              <small class="text-muted mt-1 d-block" 
                     *ngIf="f['compradorTelefono'].touched && f['compradorTelefono'].invalid">
                Formato sugerido: +51999123456
              </small>
            </div>
          </div>
        </section>

        <!-- ====================== DIRECCIÓN DE ENVÍO ====================== -->
        <section class="form-section">
          <h5 class="section-title">
            <i class="bi bi-geo-alt-fill"></i> Dirección de Envío
          </h5>

          <div class="row g-4">
            <div class="col-12">
              <label class="form-label">Dirección completa <span class="required">*</span></label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     formControlName="direccionEnvio"
                     [class.is-invalid]="f['direccionEnvio'].invalid && f['direccionEnvio'].touched"
                     placeholder="Av. Principal 123, Dpto 401, Urb. Los Jardines">
              <div class="invalid-feedback">La dirección es obligatoria</div>
            </div>

            <div class="col-md-6">
              <label class="form-label">Referencia (opcional)</label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     formControlName="referenciaEnvio"
                     placeholder="Frente al parque, casa color crema">
            </div>

            <div class="col-md-6">
              <label class="form-label">Distrito <span class="required">*</span></label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     formControlName="distrito"
                     [class.is-invalid]="f['distrito'].invalid && f['distrito'].touched">
            </div>

            <div class="col-md-4">
              <label class="form-label">Provincia <span class="required">*</span></label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     formControlName="provincia"
                     [class.is-invalid]="f['provincia'].invalid && f['provincia'].touched">
            </div>

            <div class="col-md-4">
              <label class="form-label">Departamento <span class="required">*</span></label>
              <select class="form-select form-select-lg" 
                      formControlName="departamento"
                      [class.is-invalid]="f['departamento'].invalid && f['departamento'].touched">
                <option value="">Seleccionar...</option>
                @for (dep of departamentos; track dep) {
                  <option [value]="dep">{{ dep }}</option>
                }
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label">Código Postal (opcional)</label>
              <input type="text" 
                     class="form-control form-control-lg" 
                     formControlName="codigoPostal">
            </div>

            <!-- Tipo de entrega - Tarjetas elegantes -->
            <div class="col-12 mt-5">
              <label class="form-label mb-4">Tipo de entrega <span class="required">*</span></label>
              <div class="delivery-options">
                <div class="delivery-option">
                  <input type="radio" class="btn-check" id="domicilio" value="DOMICILIO" formControlName="tipoEntrega">
                  <label class="delivery-btn" for="domicilio">
                    <i class="bi bi-house-door-fill"></i>
                    <div class="delivery-text">
                      <strong>Envío a domicilio</strong>
                      <small>Entrega directa a tu puerta</small>
                    </div>
                  </label>
                </div>

                <div class="delivery-option">
                  <input type="radio" class="btn-check" id="recojo" value="RECOGIDA_EN_TIENDA" formControlName="tipoEntrega">
                  <label class="delivery-btn" for="recojo">
                    <i class="bi bi-shop"></i>
                    <div class="delivery-text">
                      <strong>Recojo en tienda</strong>
                      <small>Retira cuando quieras</small>
                    </div>
                  </label>
                </div>

                <div class="delivery-option">
                  <input type="radio" class="btn-check" id="agencia" value="AGENCIA" formControlName="tipoEntrega">
                  <label class="delivery-btn" for="agencia">
                    <i class="bi bi-box-seam"></i>
                    <div class="delivery-text">
                      <strong>Envío a agencia</strong>
                      <small>Recoge en punto autorizado</small>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ====================== BOTONES DE ACCIÓN ====================== -->
        <div class="action-buttons">
          <button type="button" 
                  class="btn btn-outline-secondary btn-lg" 
                  (click)="cancel()">
            Cancelar
          </button>

          <button type="submit" 
                  class="btn btn-success btn-lg" 
                  [disabled]="checkoutForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi bi-check-circle-fill me-2" *ngIf="!isSubmitting"></i>
            Confirmar Pedido
          </button>
        </div>
      </form>
    </div>
  </div>
</div>