<div class="catalogo-page">

  <!-- HEADER -->
  <header class="catalogo-header">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h1 class="titulo mb-1">{{ tituloPagina }}</h1>
          <p class="subtitulo mb-0">{{ totalResultados }} productos disponibles</p>
        </div>
        <a routerLink="/" class="btn-volver-inicio">
          <i class="bi bi-house-door-fill me-2"></i>
          Volver al inicio
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row g-4">

      <!-- FILTROS LATERALES -->
      <div class="col-lg-3 d-none d-lg-block">
        <div class="filtros-sidebar" data-aos="fade-right">
          <h3 class="mb-4 fw-bold">Filtros</h3>

          <div class="mb-4">
            <input 
              type="text" 
              [(ngModel)]="busqueda" 
              (input)="aplicarFiltros()" 
              placeholder="Buscar producto..." 
              class="form-control filtro-busqueda">
          </div>
<div class="mb-4">
  <label class="form-label fw-semibold d-block mb-2">
    Precio máximo: S/ {{ precioMax }}
  </label>
  <input 
    type="range" 
    [(ngModel)]="precioMax" 
    (input)="aplicarFiltros()" 
    [min]="0" 
    [max]="precioMaximoRango" 
    step="50" 
    class="form-range">
</div>

          <div class="form-check mb-4">
            <input class="form-check-input" type="checkbox" 
                   [(ngModel)]="soloEnStock" (change)="aplicarFiltros()" id="stockCheck">
            <label class="form-check-label" for="stockCheck">
              Solo productos en stock
            </label>
          </div>

          <button class="btn btn-outline-dark w-100 rounded-pill py-2" 
                  (click)="limpiarFiltros()">
            Limpiar filtros
          </button>
        </div>
      </div>

      <!-- PRODUCTOS -->
      <div class="col-lg-9">

    <!-- Buscador móvil -->
<div class="d-lg-none mb-4">
  <input type="text" [(ngModel)]="busqueda" (input)="aplicarFiltros()"
         placeholder="Buscar en {{ tituloPagina }}..." 
         class="form-control form-control-lg rounded-pill shadow-sm">
</div>

        <!-- Loading -->
        <div class="text-center py-5" *ngIf="loading">
          <div class="spinner-border text-success" style="width: 3rem; height: 3rem;"></div>
          <p class="mt-3 text-muted">Cargando productos...</p>
        </div>

        <!-- Grid de productos -->
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-3 g-4" *ngIf="!loading && productos.length">
          <div class="col" 
               *ngFor="let p of productos; let i = index" 
               data-aos="fade-up" 
               [attr.data-aos-delay]="i * 50">

            <!-- PRODUCT CARD INTEGRADO -->
            <a [routerLink]="['../../producto', p.slug]" 
               class="producto-card-link"
               [class.agotado]="p.stockTotal === 0">

              <div class="producto-card">
                <div class="imagen-container">
                  <img [src]="p.imagenPrincipal || 'https://via.placeholder.com/300x300.png?text=Sin+Imagen'" 
                       [alt]="p.nombre"
                       loading="lazy"
                       class="producto-imagen">

                  <!-- Badges -->
                  <div class="badge badge-agotado" *ngIf="p.stockTotal === 0">
                    AGOTADO
                  </div>
                  <div class="badge badge-ultimas" *ngIf="p.stockTotal > 0 && p.stockTotal <= 5">
                    ¡Últimas {{ p.stockTotal }}!
                  </div>
                </div>

                <div class="info">
                  <div class="categoria" *ngIf="p.nombreCategoria">
                    {{ p.nombreCategoria }}
                  </div>
                  <h3 class="nombre">{{ p.nombre }}</h3>

                  <div class="precio">
                    <span class="simbolo">S/</span>
                    <span class="valor">{{ p.precioMinimo | number:'1.2-2' }}</span>
                  </div>

                  <div class="stock-status" [class.disponible]="p.stockTotal > 0" [class.no-disponible]="p.stockTotal === 0">
                    <i class="bi" [class.bi-check-circle-fill]="p.stockTotal > 0" [class.bi-x-circle-fill]="p.stockTotal === 0"></i>
                    {{ p.stockTotal > 0 ? 'Disponible' : 'Sin stock' }}
                  </div>
                </div>
              </div>
            </a>
          </div>
        </div>

        <!-- Sin resultados -->
        <div class="empty-state text-center py-5 my-5" *ngIf="!loading && !productos.length">
          <i class="bi bi-search fs-1 text-muted mb-4 opacity-50"></i>
          <h4 class="text-dark">No se encontraron productos</h4>
          <p class="text-muted">Intenta con otros filtros o palabras clave</p>
          <button class="btn btn-outline-dark rounded-pill px-4" (click)="limpiarFiltros()">
            Limpiar filtros
          </button>
        </div>

      </div>
    </div>
  </div>
</div>