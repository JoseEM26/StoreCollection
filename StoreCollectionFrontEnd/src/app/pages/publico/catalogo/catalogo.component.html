<div class="catalogo-page">

  <!-- HEADER -->
  <header class="catalogo-header">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h1 class="titulo mb-1">{{ tituloPagina }}</h1>
          <p class="subtitulo mb-0">{{ totalResultados }} productos disponibles</p>
        </div>
        <a [routerLink]="['/', tienda?.slug]"  class="btn-volver-inicio">
          <i class="bi bi-house-door-fill me-2"></i> Inicio
        </a>
      </div>
    </div>
  </header>

  <div class="container py-4 py-lg-5">
    <div class="row g-4">

      <!-- FILTROS -->
      <div class="col-lg-3">
        <div class="filtros-sidebar">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold mb-0">Filtros</h3>
            <button class="btn btn-sm btn-outline-secondary d-lg-none" 
                    type="button" data-bs-toggle="collapse" data-bs-target="#filtrosMovil">
              <i class="bi bi-funnel me-1"></i> Filtros
            </button>
          </div>

          <div class="collapse show" id="filtrosMovil">
            <div class="mb-4">
              <input type="text" [(ngModel)]="busqueda" (input)="aplicarFiltros()"
                     placeholder="Buscar producto..." class="form-control rounded-pill filtro-busqueda">
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold d-block mb-2">Precio máximo: S/ {{ precioMax }}</label>
              <input type="range" [(ngModel)]="precioMax" (input)="aplicarFiltros()"
                     [min]="0" [max]="precioMaximoRango" step="50" class="form-range">
            </div>

            <div class="form-check mb-4">
              <input class="form-check-input" type="checkbox" [(ngModel)]="soloEnStock" 
                     (change)="aplicarFiltros()" id="stockCheck">
              <label class="form-check-label" for="stockCheck">Solo en stock</label>
            </div>

            <button class="btn btn-outline-secondary w-100 rounded-pill py-2" (click)="limpiarFiltros()">
              Limpiar filtros
            </button>
          </div>
        </div>
      </div>

      <!-- PRODUCTOS -->
      <div class="col-lg-9">
        <!-- Loading -->
        <div class="text-center py-5 my-5" *ngIf="loading">
          <div class="spinner-border text-success" style="width: 3.5rem; height: 3.5rem;"></div>
          <p class="mt-4 fs-5 text-muted">Cargando catálogo...</p>
        </div>

        <!-- Grid de productos -->
        <div class="row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3 g-md-4" 
             *ngIf="!loading && productos.length">

          <div class="col" *ngFor="let p of productos; let i = index" data-aos="fade-up" [attr.data-aos-delay]="i * 60">
            <a [routerLink]="['../producto', p.slug]" class="producto-card-link text-decoration-none"
               [class.agotado]="p.stockTotal === 0">

              <div class="producto-card h-100">
                <div class="imagen-container">
                  <img [src]="p.imagenPrincipal || 'https://via.placeholder.com/400x400?text=Sin+Imagen'" 
                       [alt]="p.nombre" loading="lazy" class="producto-imagen">
                  
                  <div class="badge badge-agotado" *ngIf="p.stockTotal === 0">AGOTADO</div>
                  <div class="badge badge-ultimas" *ngIf="p.stockTotal > 0 && p.stockTotal <= 5">
                    ¡Últimas {{ p.stockTotal }}!
                  </div>
                </div>

                <div class="info">
                  <div class="categoria" *ngIf="p.nombreCategoria">{{ p.nombreCategoria }}</div>
                  <h3 class="nombre">{{ p.nombre }}</h3>

                  <div class="precio">
                    <span class="simbolo">S/</span>
                    <span class="valor">{{ p.precioMinimo | number:'1.2-2' }}</span>
                  </div>

                  <div class="stock-status" 
                       [class.disponible]="p.stockTotal > 0" 
                       [class.no-disponible]="p.stockTotal === 0">
                    <i class="bi me-1" [ngClass]="p.stockTotal > 0 ? 'bi-check-circle-fill' : 'bi-x-circle-fill'"></i>
                    {{ p.stockTotal > 0 ? 'En stock' : 'Sin stock' }}
                  </div>
                </div>
              </div>
            </a>
          </div>
        </div>

        <!-- Sin resultados -->
        <div class="empty-state text-center py-5 my-5" *ngIf="!loading && !productos.length">
          <i class="bi bi-search fs-1 text-muted mb-4 opacity-60"></i>
          <h4 class="text-dark mb-3">No se encontraron productos</h4>
          <p class="text-muted mb-4">Prueba con otros términos o limpia los filtros</p>
          <button class="btn btn-outline-dark rounded-pill px-5 py-2" (click)="limpiarFiltros()">
            Limpiar filtros
          </button>
        </div>
      </div>
    </div>
  </div>
</div>