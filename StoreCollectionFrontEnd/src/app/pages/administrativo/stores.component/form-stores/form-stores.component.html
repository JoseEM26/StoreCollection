<div class="modal-overlay" (click)="onCancel()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ isEditMode ? 'Editar Tienda' : 'Crear Tienda' }}</h3>
      <button type="button" class="btn-close" (click)="onCancel()" [disabled]="loading"></button>
    </div>

    <form (ngSubmit)="onSubmit()" class="modal-body">
      <!-- Preview del logo (opcional) -->
      <div class="text-center mb-4">
        <img
          *ngIf="logoPreview"
          [src]="logoPreview"
          alt="Logo"
          class="logo-preview"
        />
        <div *ngIf="!logoPreview" class="logo-placeholder">
          Sin logo
        </div>
      </div>

      <div class="row g-3">
        <!-- Nombre -->
        <div class="col-12">
          <label class="form-label">Nombre de la tienda *</label>
          <input
            [(ngModel)]="form.nombre"
            name="nombre"
            (input)="onNombreChange()"
            type="text"
            class="form-control"
            placeholder="Mi Tienda"
            required
            [disabled]="loading"
          />
        </div>

        <!-- Slug -->
        <div class="col-12">
          <label class="form-label">Slug (URL) *</label>
          <div class="input-group">
            <span class="input-group-text">storecollection.com/</span>
            <input
              [(ngModel)]="form.slug"
              name="slug"
              type="text"
              class="form-control"
              placeholder="mi-tienda"
              required
              [disabled]="loading || isEditMode"
            />
          </div>
        </div>

        <!-- Usuario -->
        <div class="col-12">
          <label class="form-label">Propietario (Usuario) *</label>
          <select
            [(ngModel)]="form.userId"
            name="userId"
            class="form-select"
            [disabled]="loading || usuariosLoading"
            required
          >
            <option value="0" disabled>Seleccione un usuario</option>
            <option *ngFor="let u of usuarios" [value]="u.id">
              {{ u.descripcion }}
            </option>
          </select>
        </div>

        <!-- WhatsApp y Moneda -->
        <div class="col-md-6">
          <label class="form-label">WhatsApp</label>
          <input
            [(ngModel)]="form.whatsapp"
            name="whatsapp"
            type="text"
            class="form-control"
            placeholder="+51 999 999 999"
            [disabled]="loading"
          />
        </div>

        <div class="col-md-6">
          <label class="form-label">Moneda</label>
          <select [(ngModel)]="form.moneda" name="moneda" class="form-select" [disabled]="loading">
            <option value="SOLES">Soles (S/)</option>
            <option value="DOLARES">Dólares ($)</option>
          </select>
        </div>

        <!-- Plan -->
        <div class="col-12">
          <label class="form-label">Plan</label>
          <select [(ngModel)]="form.planId" name="planId" class="form-select" [disabled]="loading">
            <option *ngFor="let p of planes" [value]="p.id">{{ p.nombre }}</option>
          </select>
        </div>

        <!-- URL del Logo -->
        <div class="col-12">
          <label class="form-label">URL del Logo</label>
          <input
            [(ngModel)]="form.logo_img_url"
            name="logo_img_url"
            (input)="onLogoUrlChange()"
            type="url"
            class="form-control"
            placeholder="https://ejemplo.com/logo.png"
            [disabled]="loading"
          />
        </div>

        <!-- Descripción -->
        <div class="col-12">
          <label class="form-label">Descripción</label>
          <textarea
            [(ngModel)]="form.descripcion"
            name="descripcion"
            rows="3"
            class="form-control"
            placeholder="Descripción de la tienda..."
            [disabled]="loading"
          ></textarea>
        </div>

        <!-- Dirección y Horarios -->
        <div class="col-md-6">
          <label class="form-label">Dirección</label>
          <input
            [(ngModel)]="form.direccion"
            name="direccion"
            type="text"
            class="form-control"
            placeholder="Av. Ejemplo 123"
            [disabled]="loading"
          />
        </div>

        <div class="col-md-6">
          <label class="form-label">Horarios</label>
          <input
            [(ngModel)]="form.horarios"
            name="horarios"
            type="text"
            class="form-control"
            placeholder="Lun-Sáb 9-21h"
            [disabled]="loading"
          />
        </div>

        <!-- Mapa -->
        <div class="col-12">
          <label class="form-label">URL de Google Maps</label>
          <input
            [(ngModel)]="form.mapa_url"
            name="mapa_url"
            type="url"
            class="form-control"
            placeholder="https://maps.google.com/..."
            [disabled]="loading"
          />
        </div>
      </div>

      <!-- Botones -->
      <div class="mt-4 d-flex gap-2 justify-content-end">
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="loading">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isEditMode ? 'Guardar' : 'Crear' }}
        </button>
      </div>
    </form>
  </div>
</div>