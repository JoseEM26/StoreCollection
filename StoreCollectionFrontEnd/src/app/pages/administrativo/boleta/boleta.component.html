<div class="container py-5">
  <!-- Header -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4 gap-3">
    <h2 class="mb-0 fw-bold text-primary">
      <i class="bi bi-receipt-cutoff me-2"></i>
      Gestión de Pedidos
    </h2>

    <div class="d-flex gap-3 align-items-center flex-wrap">
      <!-- Filtro por estado -->
      <div class="input-group" style="width: 200px;">
        <label class="input-group-text bg-light">Estado</label>
      <select class="form-select" [(ngModel)]="selectedEstado" (ngModelChange)="filtrarPorEstado()">
  <option value="">Todos</option>
  <option value="PENDIENTE">Pendiente</option>
  <option value="ATENDIDA">Atendida</option>
  <option value="CANCELADA">Cancelada</option>
</select>
      </div>

      <!-- Botón refrescar -->
      <button class="btn btn-outline-primary btn-sm" (click)="cargarBoletas()">
        <i class="bi bi-arrow-repeat me-1"></i> Actualizar
      </button>
    </div>
  </div>

  <!-- Mensajes -->
  <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    {{ errorMessage }}
    <button type="button" class="btn-close ms-auto" (click)="errorMessage = null"></button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Obteniendo pedidos...</p>
  </div>

  <!-- Contenido principal -->
  <ng-container *ngIf="!isLoading">
    <!-- Sin pedidos -->
    <div *ngIf="boletas.length === 0" class="text-center py-5 bg-light rounded-3 shadow-sm">
      <i class="bi bi-inbox display-1 text-muted"></i>
      <h4 class="mt-3 text-muted">No hay pedidos registrados</h4>
      <p class="text-muted">Los nuevos pedidos aparecerán aquí</p>
    </div>

    <!-- Tabla + Paginación -->
    <div *ngIf="boletas.length > 0" class="card shadow-sm border-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Pedido</th>
                <th>Fecha</th>
                <th>Productos</th>
                <th class="text-end">Total</th>
                <th>Estado</th>
                <th class="text-end pe-4">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let boleta of boletas" class="align-middle">
                <td class="ps-4 fw-medium">#{{ boleta.id }}</td>
                <td>{{ formatDate(boleta.fecha) }}</td>
                <td>{{ getTotalItems(boleta.detalles) }} artículos</td>
                <td class="text-end fw-bold">S/ {{ boleta.total | number:'1.2-2' }}</td>
                <td>
                  <span class="badge rounded-pill px-3 py-2 fs-6"
                        [ngClass]="getEstadoBadge(boleta.estado).class">
                    {{ getEstadoBadge(boleta.estado).text }}
                  </span>
                </td>
                <td class="text-end pe-4">
                  <button class="btn btn-sm btn-outline-secondary me-2" 
                          (click)="verDetalle(boleta)">
                    <i class="bi bi-eye"></i>
                  </button>

                  <button *ngIf="boleta.estado === 'PENDIENTE'"
                          class="btn btn-sm btn-success me-2"
                          (click)="cambiarEstado(boleta, 'ATENDIDA')">
                    <i class="bi bi-check2"></i> Atender
                  </button>

                  <button *ngIf="boleta.estado === 'PENDIENTE'"
                          class="btn btn-sm btn-outline-danger"
                          (click)="cambiarEstado(boleta, 'CANCELADA')">
                    <i class="bi bi-x"></i> Cancelar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

   <!-- ... (el resto del HTML se mantiene igual hasta la paginación) -->

<!-- Paginación mejorada -->
<div class="card-footer bg-light d-flex justify-content-between align-items-center flex-wrap gap-3">
  <div class="text-muted">
    Mostrando {{ boletas.length }} de {{ totalElements }} pedidos
    <span class="ms-2">(Página {{ currentPage + 1 }} de {{ totalPages }})</span>
  </div>

  <nav aria-label="Paginación de pedidos">
    <ul class="pagination pagination-sm mb-0">
      <li class="page-item" [class.disabled]="currentPage === 0">
        <button class="page-link" (click)="cargarBoletas(0)" aria-label="Primera">«</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === 0">
        <button class="page-link" (click)="paginaAnterior()" aria-label="Anterior"><</button>
      </li>

      <!-- Páginas visibles (sin Math en template) -->
      <li class="page-item" 
          *ngFor="let page of visiblePages"
          [class.active]="page === currentPage">
        <button class="page-link" (click)="cargarBoletas(page)">
          {{ page + 1 }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="currentPage >= totalPages - 1">
        <button class="page-link" (click)="paginaSiguiente()" aria-label="Siguiente">></button>
      </li>
      <li class="page-item" [class.disabled]="currentPage >= totalPages - 1">
        <button class="page-link" (click)="cargarBoletas(totalPages - 1)" aria-label="Última">»</button>
      </li>
    </ul>
  </nav>
</div>

<!-- ... resto del modal y HTML se mantiene igual -->
    </div>
  </ng-container>

  <!-- Modal de Detalle (sin cambios importantes) -->
  <div class="modal fade" id="detalleModal" tabindex="-1"
       [class.show]="boletaSeleccionada" [style.display]="boletaSeleccionada ? 'block' : 'none'"
       (click)="cerrarDetalle()">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content shadow-lg border-0" (click)="$event.stopPropagation()">
        <div class="modal-header bg-gradient-primary text-white">
          <h5 class="modal-title fw-bold">
            <i class="bi bi-receipt-cutoff me-2"></i>
            Pedido #{{ boletaSeleccionada?.id }}
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="cerrarDetalle()"></button>
        </div>

        <div class="modal-body" *ngIf="boletaSeleccionada">
          <div class="row g-4 mb-4">
            <div class="col-md-6">
              <div class="small text-muted">Fecha</div>
              <div class="fw-bold">{{ formatDate(boletaSeleccionada.fecha) }}</div>
            </div>
            <div class="col-md-6 text-md-end">
              <div class="small text-muted">Estado</div>
              <span class="badge rounded-pill px-3 py-2 fs-6"
                    [ngClass]="getEstadoBadge(boletaSeleccionada.estado).class">
                {{ getEstadoBadge(boletaSeleccionada.estado).text }}
              </span>
            </div>
          </div>

          <h6 class="mb-3">Productos</h6>
          <div class="list-group mb-4">
            <div *ngFor="let item of boletaSeleccionada.detalles" 
                 class="list-group-item list-group-item-action px-3 py-3">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <div class="fw-semibold">{{ item.nombreProducto }}</div>
                  <div class="text-muted small">
                    <i class="bi bi-upc-scan me-1"></i>
                    {{ item.sku || 'Sin código SKU' }}
                  </div>
                </div>
                <div class="text-end">
                  <span class="badge bg-light text-dark px-2 py-1 mb-1 d-inline-block">
                    ×{{ item.cantidad }}
                  </span>
                  <div class="fw-bold text-primary">S/ {{ item.subtotal | number:'1.2-2' }}</div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
            <span class="fs-5 fw-bold">Total</span>
            <span class="fs-4 fw-bolder text-primary">S/ {{ boletaSeleccionada.total | number:'1.2-2' }}</span>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-secondary px-4" (click)="cerrarDetalle()">
            Cerrar
          </button>

          <ng-container *ngIf="boletaSeleccionada?.estado === 'PENDIENTE'">
            <button type="button" class="btn btn-success px-4" 
                    (click)="cambiarEstado(boletaSeleccionada!, 'ATENDIDA')">
              <i class="bi bi-check2-all me-1"></i> Marcar como Atendido
            </button>
            <button type="button" class="btn btn-outline-danger px-4" 
                    (click)="cambiarEstado(boletaSeleccionada!, 'CANCELADA')">
              <i class="bi bi-x-lg me-1"></i> Cancelar Pedido
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>