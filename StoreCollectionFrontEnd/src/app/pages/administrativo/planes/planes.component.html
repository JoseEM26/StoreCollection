<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-5 gap-4">
    <div>
      <h1 class="h2 fw-bold text-dark mb-2">
        <i class="bi bi-credit-card-2-back-fill text-primary me-3"></i>
        Gestión de Planes
      </h1>
      <p class="text-muted mb-0">
        Administra los planes de suscripción disponibles
        <span class="badge bg-primary fs-6 ms-2">
          {{ pageData()?.totalElements || 0 }} planes
        </span>
      </p>
    </div>
    <button class="btn btn-primary btn-lg rounded-pill px-5 shadow-sm" (click)="abrirCrear()">
      <i class="bi bi-plus-circle me-2"></i>
      Nuevo Plan
    </button>
  </div>

  <!-- Search Bar -->
  <div class="row mb-4">
    <div class="col-lg-6 col-xl-5">
      <div class="input-group input-group-lg shadow-sm">
        <span class="input-group-text bg-white border-end-0">
          <i class="bi bi-search text-muted"></i>
        </span>
        <input
          type="text"
          class="form-control border-start-0 ps-0"
          placeholder="Buscar por nombre del plan..."
          [(ngModel)]="searchTerm"
          (keyup)="onSearch()"
        />
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="text-center py-5 my-5">
    <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-4 text-muted fs-5">Cargando planes...</p>
  </div>

  <!-- Table Card -->
  <div *ngIf="!loading() && planes().length > 0" class="card shadow border-0 rounded-4 overflow-hidden">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead class="bg-light">
            <tr>
              <th class="ps-4 py-3 fw-semibold text-uppercase text-secondary small">Plan</th>
              <th class="py-3 fw-semibold text-uppercase text-secondary small">Precio</th>
              <th class="py-3 fw-semibold text-uppercase text-secondary small">Máx. Productos</th>
              <th class="py-3 fw-semibold text-uppercase text-secondary small">Período Vigente</th>
              <th class="text-end pe-4 py-3 fw-semibold text-uppercase text-secondary small">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of planes(); trackBy: trackById" class="border-bottom">
              <td class="ps-4 py-4">
                <div class="fw-bold text-dark">{{ p.nombre }}</div>
              </td>
              <td class="py-4">
                <span class="fs-5 fw-bold text-primary">
                  {{ formatPrecio(p.precio) }}
                </span>
              </td>
              <td class="py-4">
                <span class="badge bg-info text-dark fs-6 px-3 py-2">
                  {{ p.maxProductos }} productos
                </span>
              </td>
              <td class="py-4 text-muted">
                {{ getMesesTexto(p.mesInicio, p.mesFin) }}
              </td>
             <td class="text-end pe-4 py-4">
  <div class="d-flex justify-content-end align-items-center gap-2">
    <!-- Toggle Activo/Inactivo -->
    <button
      class="btn btn-sm rounded-circle shadow-sm"
      [class.btn-success]="p.activo"
      [class.btn-danger]="!p.activo"
      (click)="toggleActivo(p)"
      [title]="p.activo ? 'Desactivar plan' : 'Activar plan'"
    >
      <i class="bi fs-5" [class.bi-toggle-on]="p.activo" [class.bi-toggle-off]="!p.activo"></i>
    </button>

    <!-- Editar -->
    <button class="btn btn-outline-primary btn-sm rounded-circle" (click)="abrirEditar(p)" title="Editar">
      <i class="bi bi-pencil"></i>
    </button>

  
  </div>
</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && planes().length === 0" class="text-center py-5 my-5">
    <div class="mb-4">
      <i class="bi bi-credit-card-2-back display-1 text-muted opacity-25"></i>
    </div>
    <h3 class="text-dark fw-semibold">No se encontraron planes</h3>
    <p class="text-muted lead" *ngIf="searchTerm">
      No hay resultados para "<strong>{{ searchTerm }}</strong>"
    </p>
    <p class="text-muted lead" *ngIf="!searchTerm">
      Aún no has creado ningún plan de suscripción
    </p>
    <button class="btn btn-primary btn-lg rounded-pill px-5 mt-3" (click)="abrirCrear()">
      <i class="bi bi-plus-circle me-2"></i>
      Crear primer plan
    </button>
  </div>

  <!-- Pagination -->
  <div *ngIf="pageData() && pageData()!.totalPages > 1" class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-5 gap-3">
    <p class="text-muted mb-0">
      Mostrando {{ startItem }} - {{ endItem }} de {{ pageData()?.totalElements }} planes
    </p>
    <nav>
      <ul class="pagination pagination-lg mb-0">
        <li class="page-item" [class.disabled]="currentPage() === 0">
          <button class="page-link" (click)="goToPage(currentPage() - 1)">
            <i class="bi bi-chevron-left"></i>
          </button>
        </li>

        <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage()">
          <button class="page-link" (click)="goToPage(page)">{{ page + 1 }}</button>
        </li>

        <li class="page-item" [class.disabled]="currentPage() === (pageData()!.totalPages - 1)">
          <button class="page-link" (click)="goToPage(currentPage() + 1)">
            <i class="bi bi-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Modal -->
  <div class="modal fade" tabindex="-1" [ngClass]="{'show d-block': showModal(), 'd-none': !showModal()}">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div class="modal-header border-0 pb-0">
          <button type="button" class="btn-close" (click)="closeModal()" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body pt-0">
          <app-planes-form
            [plan]="editingPlan()"
            (success)="onFormSuccess()"
            (cancel)="closeModal()"
          ></app-planes-form>
        </div>
      </div>
    </div>
  </div>

  <!-- Backdrop -->
  <div class="modal-backdrop fade show" *ngIf="showModal()" (click)="closeModal()"></div>
</div>